<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="keywords" content="HTML, CSS, Javascript, Python, fundamentals, Full-text search, Python fundamentals, HTML, Django, Postgress, Full-Text Search | Django | PostgreSQL">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="addleonel, A.D. Leonel">
		<meta name="description" content="Full-text search, Python fundamentals, HTML, Django, Postgress, Full-Text Search | Django | PostgreSQL">
		<title>Full-Text Search | Django | PostgreSQL</title>

		<!--Website icon-->
		<link href="../img/code-solid.svg" rel="icon" type="image/svg+xml" size="any">

		<!--Bootstrap core CSS-->
		<link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">

		<!--Custom fonts for this template-->
		<link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
		<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet" type="text/css">
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet" type="text/css">
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" type="text/css">		
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
		<!-- highlight api -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.1/build/styles/github-dark.min.css" integrity="sha256-nyCNAiECsdDHrr/s2OQsp5l9XeY2ZJ0rMepjCT2AkBk=" crossorigin="anonymous">		
		<!-- local css links -->
		<link rel="stylesheet" href="../css/styles.css">
	<body>
		<!-- Navigation  -->
		<nav id="mainNav" class="navbar navbar-expand-lg navbar-light fixed-top">
			<div class="container">
				<a class="navbar-brand" href="../">A.D.Leonel</a>
				<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
			  		<i class="fas fa-bars"></i>
				</button>
			 	<div class="collapse navbar-collapse" id="navbarResponsive">
				  	<ul class="navbar-nav ml-auto">
					    <li class="nav-item">
				  	      <a class="nav-link" href="../">Home</a>
					    </li>
				        <li class="nav-item">
				        	<a class="nav-link" href="../posts.html">Posts</a>
				        </li>
				        <li class="nav-item">
				        	<a class="nav-link" href="../about.html">About</a>
				        </li>
				        <li class="nav-item">
				        	<a class="nav-link" href="../mailto:adleonel3633@gmail.com">Contact</a>
				        </li>
				    </ul>
				</div>
			</div>
		</nav>


		<!-- Page Header -->
		<header class="masthead">
			<div class="overlay"></div>
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-10 mx-auto">
						<div class="site-heading">
							<img class="post-image" src="https://images.pexels.com/photos/546819/pexels-photo-546819.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500" alt="">
							<h1> 
								Full-Text Search | Django | Postgres
							</h1>
							<p class="post-meta-inside">
								Posted On June 5, 2021
							</p>
						</div>
					</div>
				</div>
			</div>
		</header>

		<main class="container">
			<div class="row">
				<div class="col-lg-8 mx-auto">
					<section class="post-content">
						<h3>What is Full-Text Search?</h3>
						<p> <a class="link-text mark-text" target="_blank" href="http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.sqlanywhere.12.0.1/dbusage/full-text-search-what-is-it.html">
							Full-text search</a> 
							refers to techniques for searching a single computer-stored document or a collection in a full-text database. Full-text search is distinguished from searches based on metadata or on parts of the original texts represented in databases (such as titles, abstracts, selected sections, or bibliographical references).
						</p>
						<h3>PostgresSQL Support</h3>
						<p>PostgreSQL has its own full-text search implementation built-in. While not as powerful as some other search engines, it has the advantage of being inside your database and so can easily be combined with other relational queries such as categorization.
						</p>
						<p>The database functions in the django.contrib.postgres.search module ease the use of PostgreSQL’s full text search engines.
						</p>
						<p>For use this tools is most easily to setup an example with a simple app into Django
						</p>
						<p>Read more about <a class="link-text mark-text" target="_blank" href="https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/">postgresSQL support</a></p>
						<h3>Create a Model</h3>
						<figure>

<pre>
<code class="language-python">
from django.db import models

class Entity(models.Model):

    name = models.CharField(max_length=150)
    email = models.EmailField(max_length=300)
    city = models.CharField(max_length=300)
    country = models.CharField(max_length=300)
    url = models.URLField(max_length=400, blank=True)
    apply = models.BooleanField(default=False)
    description = models.TextField(blank=False)

    def __str__(self):
	    return self.name

</code>
</pre>
						</figure>
						<h3>Create view function-based (in this case)</h3>
						<p>Inside to views.py</p>
<pre><code class="language-python">
def search(request):
	pass
</code>
</pre>
						<p>For now, this is basically the begin</p>
						<h3>View’s URL</h3>
						<p>Inside to urls.py</p>
<pre>
<code>
# django 
from django.urls import path
# project 
from .views import search

urlpatterns = [
    path('search', search, name='search'),
]
</code>
</pre>
						<h3>Create View Template</h3>
						<p>Into search.html file</p>
						
<pre>
<code class="language-html">
{# This will be explain after #}
{{ count_filters }}
{% for entity in entities_filtered %}
&ltp&gt{{ entity.name }}&lt/p&gt
&ltp&gt{{ entity.email }}&lt/p&gt
&ltp&gt{{ entity.city }}&lt/p&gt
&ltp&gt{{ entity.country }}&lt/p&gt
&ltp&gt{{ entity.url }}&lt/p&gt
&ltp&gt{{ entity.apply }}&lt/p&gt
&ltp&gt{{ entity.description}}&lt/p&gt
{% endfor %}
</code>
</pre>
						<p>Now into search-form.html, we are going to create the form to actions the search view</p>			
<pre>
<code class="language-html">
&ltform action="{% url 'search' %}" method="GET"&gt
    &ltinput name="q" type="text" placeholder="Search"&gt
    &ltbutton>Search&lt/button&gt
&lt/form&gt
</code>
</pre>			
						
						<h3>SearchVector Implementation</h3>
						<p>How to use:</p>

<pre>
<code class="language-python">
>>> from django.contrib.postgres.search import SearchVector
>>> Entry.objects.annotate(
...     search=SearchVector('body_text', 'blog__tagline'),
... ).filter(search='Cheese')
[&ltEntry: Cheese on Toast recipes&gt, &ltEntry: Pizza Recipes&gt]
</code>
</pre>					<p>For more information about <a class="link-text mark-text" target="_blank" href="https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/search/#searchvector">SearchVector</a>.</p>
						<p>Now in our view code that we created above.</p>
<pre>
<code class="language-python">
from django.contrib.postgree.search import SearchVector

def search(request):
    
    # Here we get the value of the search field from the template
    q = request.GET.get('q', '').strip()

    # Here we are going to type the principal attributes
    # that we want to search in the search field form
    # in this case are: name, city, country, description, 
    # and created_at
    entity_vector = SearchVector(
        'name', 'city', 'country', 'description', 'created_at'
    )
</code>
</pre>	
						<h3>SearchQuery Implementation</h3>
						<p>How to use:</p>
<pre>
<code class="language-python">
>>> from django.contrib.postgres.search import SearchQuery
>>> SearchQuery('red tomato')  # two keywords
>>> SearchQuery('tomato red')  # same results as above
>>> SearchQuery('red tomato', search_type='phrase')  # a phrase
>>> SearchQuery('tomato red', search_type='phrase')  # a different phrase
>>> SearchQuery("'tomato' & ('red' | 'green')", search_type='raw')  # boolean operators
>>> SearchQuery("'tomato' ('red' OR 'green')", search_type='websearch')  # websearch operators
</code>
</pre>
</pre>					<p>For more information about <a class="link-text mark-text" target="_blank" href="https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/search/#searchquery">SearchQuery</a>.</p>
						<p>Now in our view code that we created above</p>
<pre>
<code class="language-python">
from django.contrib.postgree.search import (SearchVector,
    SearchQuery
) 

def search(request):
	
    # Here we get the value of the search field from the template
    search_field_query = request.GET.get('q', '').strip()

    # Here we are going to type the principal attributes
    # that we want to search in the search field form
    # in this case are: name, city, country, description, 
    # and created_at
    entity_vector = SearchVector(
        'name', 'city', 'country', 'description', 'created_at'
    )
    
    # Here we just pass the value of the search field query
    entity_query = SearchQuery(search_field_query)
</code>
</pre>
						<h3>SearchRank Implementation</h3>
						<p>How to use:</p>
<pre>
<code>
>>> from django.contrib.postgres.search import SearchQuery, SearchRank, SearchVector
>>> vector = SearchVector('body_text')
>>> query = SearchQuery('cheese')
>>> Entry.objects.annotate(rank=SearchRank(vector, query)).order_by('-rank')
[&ltEntry: Cheese on Toast recipes&gt, &ltEntry: Pizza recipes&gt]
</code>
</pre>
</pre>					<p>For more information about <a class="link-text mark-text" target="_blank" href="https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/search/#searchrank">SearchRank</a>.</p>
						<p>Now in our view code that we created above</p>
<pre>
<code>
from django.shortcuts import render
from django.contrib.postgree.search import (SearchVector,
    SearchQuery
) 
from .models import Entity

def search(request):
    # This is to count how many object there are (it's optional)
    count_filters = 0

    # Here we get the value of the search field from the template
    search_field_query = request.GET.get('q', '').strip()

    # Here we are going to type the principal attributes
    # that we want to search in the search field form
    # in this case are: name, city, country, description, 
    # and created_at
    entity_vector = SearchVector(
        'name', 'city', 'country', 'description', 'created_at'
    )
    
    # Here we just pass the value of the search field query
    entity_query = SearchQuery(search_field_query)
    
    # Here we pass the entity_vector and entity_query
    entities_filtered = Entity.objects.annotate(
        rank=SearchRank(entity_vector, entity_query)
    ).order_by('-rank')
    
    # count filters
    count_filters += entities_filtered.count()

    # Now We are going to create the context dictionary
    context = {
        'entities_filtered': entities_filtered,
        'count_filters': count_filters,
    }

    # Now we are going to complete with our view 
    return render(request, 'search/search.html', context)
</code>
</pre>
				<h3>Search View Class-Based</h3>
				<p>The same search view, now with class:</p>
<pre>
<code class="language-python">
from django.shortcuts import render
from django.views import View
from django.contrib.postgree.search import (SearchVector,
    SearchQuery
) 
from .models import Entity

class SearchEntityView(View):
    template_name = 'search/search.html'
    
    def get(self, request, *args, **kwargs):
        count_filters = 0

        search_field_query = request.GET.get('q', '').strip()

        entity_vector = SearchVector(
            'name', 'city', 'country', 'description', 'created_at'
        )

        entity_query = SearchQuery(search_field_query)
    
        entities_filtered = Entity.objects.annotate(
            rank=SearchRank(entity_vector, entity_query)
        ).order_by('-rank')

        count_filters += entities_filtered.count()

        context = {
            'entities_filtered': entities_filtered,
            'count_filters': count_filters,
        }

        return render(request, self.template_name, context)
</code>
</pre>
				<p>Then change the url.py path:</p>
<pre>
<code>
# django 
from django.urls import path
# project 
from .views import SearchEntityView

urlpatterns = [
    path('search', SearchEntityView.as_view(), name='search'),
]
</code>
</pre>
				<p>If you want to read yourself from the <a class="link-text mark-text" target="_blank" href="https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/search/#full-text-search">Django docs</a> just do it.</p>
				</section>
				</div>
			</div>
		</main>

		<section class="container more-post">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<a class="more-post__link" href="../posts.html">All posts <i class="fas fa-angle-double-right"></i></a>
				</div>
			</div>	
		</section>

		<footer>
			<div class="container">
				<div clasS="row">
					<div class="col-lg-8 col-md-10 mx-auto">
						<ul class="list-inline text-center">
							<li class="list-inline-item">
								<a href="https://github.com/addleonel" target="_blank">
									<span class="fa-stack fa-lg">
									<i class="fab fa-github fa-stack-1x fa-inverse"></i>
									</span>
								</a>
							</li>
							<li class="list-inline-item">
								<a href="https://twitter.com/addleonel" target="_blank">
									<span class="fa-stack fa-lg">
									<i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
									</span>
								</a>
							</li>
						</ul>
						<p class="text-center">Copyright &copy 2021</p>
					</div>
				</div>
			</div>
		</footer>
		<!--Bootstrap core Javascript-->
		<script src="../vendor/jquery/jquery.min.js" type="text/javascript"></script>
		<script src="../vendor/bootstrap/js/bootstrap.bundle.min.js" type="text/javascript"></script>
		<!-- highlightjs cnd jsdelivr -->
		<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.1/build/highlight.min.js" integrity="sha256-dqCB8TvWVK+taTDV0duIDJVAINbuwflQIsclMJ3vKb0=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.1/build/languages/python.min.js" integrity="sha256-zLW+5z96ZSpao3OTAqw5fNaYdjHwZ0W0cBhBB4KZTJg=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.1/build/languages/vbscript-html.min.js" integrity="sha256-3MX+VxGlsX19gmURaWIHX9i2H8v/nYeAJWWZzZVQi6I=" crossorigin="anonymous"></script>

		<script>hljs.highlightAll();</script>
		<!-- Custom scripts for this template -->
		<script src="../js/jscript.js" type="text/javascript"></script>
	</body>
</html>
